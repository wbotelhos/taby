/*!
 * jQuery Taby - A Textarea Tabulator
 *
 * Licensed under The MIT License
 *
 * @version        1.0.0
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/taby
 *
 */

;(function(b){var a={init:function(c){return this.each(function(){this.opt=b.extend({},b.fn.taby.defaults,c);var d=b(this).off(".taby");a._adjustTab.call(this);a._bind.call(this);d.data({settings:this.opt,taby:true});});},_adjustTab:function(){this.opt.tab="";for(var c=0;c<this.opt.space;c++){this.opt.tab+=" ";}},_backspace:function(){var c=b(this).data("settings"),d=this.selectionStart;if(c.backspace&&this.value.slice(d-c.tab.length,d)==c.tab){this.evt.preventDefault();this.value=this.value.slice(0,d-c.tab.length)+this.value.slice(d);this.selectionStart=d-c.tab.length;this.selectionEnd=d-c.tab.length;}},_bind:function(){b(this).on(a._eventName(),function(c){var d=c.keyCode||c.which;if(c.metaKey){return;}this.evt=c;if(d==9){if(c.shiftKey){a._shiftTab.call(this);}else{a._tab.call(this);}}else{if(d==8){a._backspace.call(this);}else{if(d==46){a._del.call(this);}else{if(d==37){a._left.call(this);}else{if(d==39){a._right.call(this);}}}}}});},_del:function(){var d=b(this).data("settings"),e=this.selectionStart,c=this.selectionEnd;if(d.del&&this.value.slice(e,e+d.tab.length)==d.tab){this.evt.preventDefault();this.value=this.value.slice(0,e)+this.value.slice(e+d.tab.length);this.selectionStart=e;this.selectionEnd=c;}},_eventName:function(){return a._isFirefox()?"keypress.taby":"keydown.taby";},_isFirefox:function(){return/firefox/.test(navigator.userAgent.toLowerCase());},_left:function(){var e=b(this).data("settings"),g=this.selectionStart,c=this.selectionEnd;if(!this.evt.shiftKey){g=c;}if(e.left===true&&this.value.slice(g-e.tab.length,g)==e.tab){this.evt.preventDefault();var d=e.tab.length,f=e.tab.length;if(this.evt.shiftKey){f=0;}this.selectionStart=g-d;this.selectionEnd=c-f;}},_right:function(){var d=b(this).data("settings"),e=this.selectionStart,c=this.selectionEnd;if(!this.evt.shiftKey){c=e;}if(d.right===true&&this.value.slice(c,c+d.tab.length)==d.tab){this.evt.preventDefault();this.selectionStart=e+(this.evt.shiftKey?0:d.tab.length);this.selectionEnd=c+d.tab.length;}},_shiftTab:function(){this.evt.preventDefault();var d=b(this).data("settings"),c=this.selectionStart,h=this.selectionEnd;preselection=this.value.slice(0,c),selection=this.value.slice(c,h),postselection=this.value.slice(h),isMultipleLine=selection.indexOf("\n")>=0,lineStart=preselection.lastIndexOf("\n"),lineEnd=h+postselection.indexOf("\n"),isFirst=c==0,previousCharacter=(isFirst)?"":this.value.slice(c-1,c);if(lineStart<0){lineStart=0;}else{lineStart++;}if(lineEnd<0){lineEnd=this.value.length;}if(isMultipleLine){if(selection.lastIndexOf("\n")==selection.length-1){lineEnd=h-1;postselection="\n"+postselection;}var l=this.value.slice(lineStart,lineEnd),m=l;m=m.replace(new RegExp("^"+d.tab),"").replace(new RegExp("\n"+d.tab,"g"),"\n");if(l==m){return;}this.value=this.value.slice(0,lineStart)+m+this.value.slice(lineEnd);var k=l.length-m.length,i=c,f=h-k;if(!isFirst&&previousCharacter!="\n"){i-=d.tab.length;}if(i<lineStart){i=lineStart;}var g=(i<0)?0:i,e=(f<0)?0:f;this.selectionStart=g;this.selectionEnd=e;}else{var l=this.value.slice(lineStart,lineEnd),m=l;if(l.indexOf(d.tab)==0){m=l.slice(d.tab.length);}if(l==m){return;}this.value=this.value.slice(0,lineStart)+m+this.value.slice(lineEnd);var j=takedEnd=d.tab.length;if(c-lineStart<d.tab.length){j=c-lineStart;if(c==h){takedEnd=j;}}this.selectionStart=c-j;this.selectionEnd=h-takedEnd;}},_tab:function(){this.evt.preventDefault();var g=b(this).data("settings"),f=this.selectionStart,h=this.selectionEnd,n=this.value.slice(0,f),q=this.value.slice(f,h),e=this.value.slice(h),m=n.lastIndexOf("\n"),j=h+e.indexOf("\n"),i=f==0,k=h==this.value.length,p=(i)?"":this.value.slice(f-1,f),d=(k)?"":this.value.slice(h,h+1);if(m<0){m=0;}else{m++;}if(j<0){j=this.value.length;}if(q.indexOf("\n")>=0){if(q.lastIndexOf("\n")==q.length-1){j=h-1;e="\n"+e;}var s=this.value.slice(m,j),r=s;r=g.tab+r.replace(new RegExp("\n","g"),"\n"+g.tab);if(s==r){return;}this.value=this.value.slice(0,m)+r+this.value.slice(j);var l=r.length-s.length,c=f,o=h+l;if(!i&&p!="\n"){c+=g.tab.length;}this.selectionStart=c;this.selectionEnd=o;}else{if((i||p=="\n")&&(k||d=="\n")&&q!=""){var s=this.value.slice(m,j);this.value=n+g.tab+s+e;this.selectionStart=f;this.selectionEnd=h+g.tab.length;}else{this.value=n+g.tab+e;this.selectionStart=f+g.tab.length;this.selectionEnd=f+g.tab.length;}}},goTo:function(c){return this.each(function(){this.focus();this.selectionStart=c;this.selectionEnd=c;});},select:function(d,c){return this.each(function(){this.focus();this.selectionStart=d;this.selectionEnd=(c===undefined)?this.value.length:c;});},set:function(c){return this.each(function(){var e=b(this),f=e.data("settings"),d=b.extend({},f,c);e.taby(d);});}};b.fn.taby=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1));}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments);}else{b.error("Method "+c+" does not exist!");}}};b.fn.taby.defaults={backspace:true,del:true,left:true,right:true,space:4};})(jQuery);
